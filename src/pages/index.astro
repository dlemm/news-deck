
---
import Layout from '../layouts/Layout.astro';
import Parser from 'rss-parser';
const parser = new Parser();

const sevenDaysAgo = new Date();
sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7);


const feedSources = [
  // Allgemeine Webentwicklung
  "https://www.smashingmagazine.com/feed/",
  "https://css-tricks.com/feed/",

  // Frontend-Entwicklung
  "https://cprss.s3.amazonaws.com/frontendfoc.us.xml",
  "https://davidwalsh.name/feed",

  // Backend-Entwicklung
  "https://dev.to/feed",

  // JavaScript
  "https://javascriptweekly.com/rss",

  // React
  "https://reactjs.org/feed.xml",
  "https://overreacted.io/rss.xml",

  // TypeScript
  "https://devblogs.microsoft.com/typescript/feed/",
  "https://www.reddit.com/r/typescript/.rss",

  // CSS
  "https://css-weekly.com/rss/",
  "https://css-tricks.com/feed/",

  // YouTube Channels
  "https://www.youtube.com/feeds/videos.xml?channel_id=UCsBjURrPoezykLs9EqgamOA",

  // Tools and Libraries
  "https://developer.mozilla.org/en-US/blog/rss.xml",

];

interface FeedItem {
  feed?: string;
  title?: string;
  link?: string;
  date?: Date;
}

const feedItems: FeedItem[] = [];

await Promise.allSettled(
  feedSources.map(async (source) => {
    try {
      const feed = await parser.parseURL(source);
      feed.items.forEach((item) => {
        const date = item.pubDate ? new Date(item.pubDate) : undefined;
        if (date && date >= sevenDaysAgo) {
          feedItems.push({
            feed: feed.title,
            title: item.title,
            link: item.link,
            date,
          });
        }
      });
    } catch (error) {
      console.error(`Error fetching feed from ${source}:`, error);
    }
  })
);

const sortedFeedItems = feedItems.sort((a, b) => (b.date ?? new Date()).getTime() - (a.date ?? new Date()).getTime());

---


<Layout title="Ahoy tor 314rate's News Deck">
  <main>
  {sortedFeedItems.map(item => (
    <ul>
      <li>
        <a href={item.link}>{item.title}</a>
        <h2>{item.title}</h2>
        <h4>{item.feed}</h4>
        <p>Published: {item.date}</p>
      </li>
    </ul>
  ))}
  </main>
</Layout>

